<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Navigator AI</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Pretendard í°íŠ¸ -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendardvariable@v1.3.8/dist/web/variable/pretendardvariable.css" />
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0KOVEMckDpbOJCUAZXLnLe84EqcB1BDQRgY/eBCeQWFCVebO2EV6T" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <!-- KaTeX auto-render extension -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* ì „ì²´ í°íŠ¸ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
            font-weight: 400;
            line-height: 1.4; /* ì¤„ê°„ê²© ì¤„ì„ */
            letter-spacing: -0.01em;
            overflow-x: hidden;
        }

        /* ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ */
        .main-layout {
            display: flex;
            min-height: 100vh;
            width: 100%;
            overflow-x: hidden;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            flex-shrink: 0;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            background: #f8fafc;
            min-width: 0;
            width: calc(100vw - 280px);
            max-width: calc(100vw - 280px);
            overflow-x: hidden;
        }

        /* ì‚¬ìš©ì íƒ€ì… ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ - ê°œì„ ëœ ë””ìì¸ */
        .user-type-selector {
            position: absolute;
            top: 0.5rem;
            left: 50%;
            transform: translateX(-50%); /* ê°€ìš´ë° ì •ë ¬ */
            display: flex;
            background: rgba(15, 23, 42, 0.8); /* ì‚¬ì´ë“œë°”ì™€ ì¡°í™”ë¡œìš´ ì–´ë‘ìš´ ë°˜íˆ¬ëª… */
            backdrop-filter: blur(12px);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 24px;
            padding: 0.25rem;
            gap: 0.25rem;
            z-index: 1100;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        }

        .user-type-btn {
            padding: 0.4rem 0.8rem;
            border-radius: 18px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #cbd5e1;
            background: transparent;
            border: none;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .user-type-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .user-type-btn:hover::before {
            opacity: 1;
        }

        .user-type-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .user-type-btn:hover:not(.active) {
            color: #60a5fa;
            transform: scale(1.02);
        }

        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar-logo {
            padding: 1rem 1.5rem 0.75rem 1.5rem;
            border-bottom: 1px solid #334155;
            margin-top: 2.75rem; /* ê°€ìš´ë° ì •ë ¬ëœ ì‚¬ìš©ì íƒ€ì… ë²„íŠ¼ê³¼ ì¶©ë¶„í•œ ê°„ê²© */
        }

        .sidebar-logo h1 {
            font-size: 1.25rem; /* í¬ê¸° ì¤„ì„ */
            font-weight: 700;
            color: #60a5fa;
            margin: 0;
        }

        .sidebar-logo p {
            font-size: 0.75rem; /* í¬ê¸° ì¤„ì„ */
        }

        .sidebar-menu {
            padding: 0.5rem 0; /* íŒ¨ë”© ì¤„ì„ */
        }

        .menu-item {
            padding: 0.5rem 1.5rem; /* íŒ¨ë”© ì¤„ì„ */
            margin: 0.2rem 0.5rem; /* ë§ˆì§„ ì¤„ì„ */
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
        }

        .menu-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
        }

        .menu-item.active {
            background: #3b82f6;
            color: white;
        }

        .menu-submenu {
            margin-left: 1rem;
            border-left: 2px solid #334155;
            padding-left: 1rem;
        }

        .submenu-item {
            padding: 0.3rem 1rem; /* íŒ¨ë”© ì¤„ì„ */
            margin: 0.1rem 0; /* ë§ˆì§„ ì¤„ì„ */
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            color: #cbd5e1;
        }

        .submenu-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
        }

        .submenu-item.active {
            background: #1e40af;
            color: white;
        }

        /* ê³µí†µ ì»¨í…ì¸  ìŠ¤íƒ€ì¼ ê°œì„  */
        .content-area {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .content-area h1, .content-area h2, .content-area h3 {
            font-weight: 700;
            margin-top: 0.75rem; /* ë§ˆì§„ ì¤„ì„ */
            margin-bottom: 0.375rem; /* ë§ˆì§„ ì¤„ì„ */
            color: #1e293b;
            line-height: 1.2; /* ì¤„ê°„ê²© ì¤„ì„ */
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .content-area h1 { font-size: 1.875rem; color: #1e40af; }
        .content-area h2 { font-size: 1.375rem; color: #2563eb; }
        .content-area h3 { font-size: 1.125rem; color: #3b82f6; }

        .content-area p {
            margin-bottom: 0.5rem; /* ë§ˆì§„ ì¤„ì„ */
            line-height: 1.4; /* ì¤„ê°„ê²© ì¤„ì„ */
            text-align: justify;
            word-spacing: 0.05em;
            color: #374151;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        .content-area ul, .content-area ol {
            margin: 0.5rem 0; /* ë§ˆì§„ ì¤„ì„ */
            padding-left: 1.5rem; /* íŒ¨ë”© ì¤„ì„ */
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .content-area li {
            margin-bottom: 0.2rem; /* ë§ˆì§„ ì¤„ì„ */
            line-height: 1.3; /* ì¤„ê°„ê²© ì¤„ì„ */
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .content-area table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0; /* ë§ˆì§„ ì¤„ì„ */
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .content-area th {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 0.75rem; /* íŒ¨ë”© ì¤„ì„ */
            font-weight: 600;
            text-align: left;
        }

        .content-area td {
            padding: 0.75rem; /* íŒ¨ë”© ì¤„ì„ */
            border-bottom: 1px solid #e2e8f0;
        }

        .content-area tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .content-area tr:hover {
            background-color: #f1f5f9;
            transition: background-color 0.2s ease;
        }

        .content-area code {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #1e293b;
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
            font-size: 0.9em;
            border: 1px solid #cbd5e1;
        }

        /* ì±„íŒ… ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .chat-bubble { 
            max-width: 90%; 
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        .chat-bubble-user {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
        }
        .chat-bubble-ai {
            background: white;
            color: #1f2937;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .blinking-cursor {
            display: inline-block;
            width: 8px;
            height: 1.2rem;
            background-color: #333;
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            from, to { background-color: transparent }
            50% { background-color: #333; }
        }

        /* AI ì‘ë‹µ ìŠ¤íƒ€ì¼ë§ ê°œì„  - ì°¸ê³ ì„œ ìŠ¤íƒ€ì¼ */
        .ai-response {
            font-family: "Pretendard Variable", Pretendard, sans-serif;
            line-height: 1.5; /* ì¤„ê°„ê²© ì¤„ì„ */
            letter-spacing: -0.01em;
            color: #374151;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
            overflow-x: hidden;
        }

        /* ì œëª© ìŠ¤íƒ€ì¼ë§ */
        .ai-response h1, .ai-response h2, .ai-response h3, .ai-response h4 {
            font-weight: 700;
            margin: 0.75rem 0 0.375rem 0; /* ë§ˆì§„ ì¤„ì„ */
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.25rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .ai-response h1 { font-size: 1.5rem; color: #1e40af; }
        .ai-response h2 { font-size: 1.25rem; color: #2563eb; }
        .ai-response h3 { font-size: 1.125rem; color: #3b82f6; }

        /* ë¬¸ë‹¨ ìŠ¤íƒ€ì¼ë§ */
        .ai-response p {
            margin-bottom: 0.75rem; /* ë§ˆì§„ ì¤„ì„ */
            text-align: justify;
            word-spacing: 0.05em;
            line-height: 1.4; /* ì¤„ê°„ê²© ì¤„ì„ */
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        /* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ë§ */
        .ai-response ul, .ai-response ol {
            margin: 0.5rem 0 0.75rem 0; /* ë§ˆì§„ ì¤„ì„ */
            padding-left: 1.5rem; /* íŒ¨ë”© ì¤„ì„ */
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .ai-response li {
            margin-bottom: 0.2rem; /* ë§ˆì§„ ì¤„ì„ */
            line-height: 1.3; /* ì¤„ê°„ê²© ì¤„ì„ */
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .ai-response ul li {
            list-style-type: none;
            position: relative;
        }

        .ai-response ul li::before {
            content: "â–ª";
            color: #3b82f6;
            font-size: 1.2em;
            position: absolute;
            left: -1.5rem;
            top: 0;
        }

        /* ê°•ì¡° í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ë§ */
        .ai-response strong, .ai-response b {
            font-weight: 700;
            color: #1e40af;
            background: linear-gradient(120deg, transparent 0%, transparent 50%, #dbeafe 50%, #dbeafe 100%);
            background-size: 200% 100%;
            background-position: 100% 0;
            transition: background-position 0.3s ease;
        }

        .ai-response em, .ai-response i {
            font-style: italic;
            color: #7c3aed;
            font-weight: 500;
        }

        /* ì½”ë“œ ë¸”ë¡ ìŠ¤íƒ€ì¼ë§ */
        .ai-response code {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #1e293b;
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 0.9em;
            border: 1px solid #cbd5e1;
        }

        .ai-response pre {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            padding: 1rem; /* íŒ¨ë”© ì¤„ì„ */
            border-radius: 12px;
            overflow-x: auto;
            margin: 1rem 0; /* ë§ˆì§„ ì¤„ì„ */
            border-left: 4px solid #3b82f6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .ai-response pre code {
            background: none;
            border: none;
            color: inherit;
            padding: 0;
        }

        /* ì¸ìš©ë¬¸ ìŠ¤íƒ€ì¼ë§ */
        .ai-response blockquote {
            border-left: 4px solid #3b82f6;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 1rem 1.5rem; /* íŒ¨ë”© ì¤„ì„ */
            margin: 1rem 0; /* ë§ˆì§„ ì¤„ì„ */
            font-style: italic;
            border-radius: 0 12px 12px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ë§ */
        .ai-response table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0; /* ë§ˆì§„ ì¤„ì„ */
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .ai-response th {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 0.75rem; /* íŒ¨ë”© ì¤„ì„ */
            font-weight: 600;
            text-align: left;
        }

        .ai-response td {
            padding: 0.75rem; /* íŒ¨ë”© ì¤„ì„ */
            border-bottom: 1px solid #e2e8f0;
        }

        .ai-response tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .ai-response tr:hover {
            background-color: #f1f5f9;
            transition: background-color 0.2s ease;
        }

        /* ë‹µì•ˆ ë°•ìŠ¤ */
        .ai-response .answer {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 1rem; /* íŒ¨ë”© ì¤„ì„ */
            margin: 1rem 0; /* ë§ˆì§„ ì¤„ì„ */
            font-weight: 500;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1);
        }

        .ai-response .answer::before {
            content: "âœ“ ë‹µ: ";
            color: #1e40af;
            font-weight: 700;
        }

        /* ì•„ì½”ë””ì–¸ ìŠ¤íƒ€ì¼ ê°œì„  */
        .accordion-item {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 0.75rem; /* ë§ˆì§„ ì¤„ì„ */
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .accordion-item:hover {
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .accordion-header {
            padding: 0.75rem 1rem; /* íŒ¨ë”© ì¤„ì„ */
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #374151;
            transition: all 0.3s ease;
        }

        .accordion-header:hover {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        }

        /* ì•„ì½”ë””ì–¸ ê°œì„  */
        .accordion-content {
            padding: 0.75rem; /* íŒ¨ë”© ì¤„ì„ */
            display: none;
            animation: fadeIn 0.4s ease-in-out;
            font-size: 0.95rem;
            line-height: 1.4; /* ì¤„ê°„ê²© ì¤„ì„ */
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
            overflow-x: hidden;
        }

        .accordion-content.active {
            display: block;
        }

        .accordion-icon {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
            color: #3b82f6;
        }

        .accordion-icon.rotated {
            transform: rotate(180deg);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì„¹ì…˜ë³„ ìƒ‰ìƒ êµ¬ë¶„ ê°•í™” */
        .section-í•™ìŠµëª©í‘œ .accordion-header { border-left: 6px solid #10b981; }
        .section-ê°œë…ì„¤ëª… .accordion-header { border-left: 6px solid #3b82f6; }
        .section-ëŒ€í‘œì˜ˆì œ .accordion-header { border-left: 6px solid #f59e0b; }
        .section-ì—°ìŠµë¬¸ì œ .accordion-header { border-left: 6px solid #ef4444; }
        .section-ì •ë‹µë°í•´ì„¤ .accordion-header { border-left: 6px solid #8b5cf6; }
        .section-ë§ˆìŠ¤í„°ë¦¬ë“œë¦´ .accordion-header { border-left: 6px solid #06b6d4; }
        .section-ì§„ë‹¨ì²´í¬ .accordion-header { border-left: 6px solid #84cc16; }
        .section-í™•ì¥í™œë™ .accordion-header { border-left: 6px solid #f97316; }
        .section-íŠœí„°íŒ .accordion-header { border-left: 6px solid #ec4899; }
        .section-í•™ë¶€ëª¨íŒ .accordion-header { border-left: 6px solid #ec4899; }

        /* ìƒë‹¨ í—¤ë” ê°œì„  - ê³ ì • ì„¤ì • */
        .top-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            padding: 0.75rem 1.25rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 50; /* ë†’ì€ z-indexë¡œ í•­ìƒ ìƒë‹¨ ê³ ì • */
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .curriculum-label {
            font-size: 0.875rem; /* í¬ê¸° ì¤„ì„ */
            font-weight: 600;
            color: #374151;
            white-space: nowrap;
        }

        .curriculum-select {
            flex: 1;
            max-width: 800px;
            padding: 0.5rem 0.75rem; /* íŒ¨ë”© ì¤„ì„ */
            border: 1px solid #d1d5db;
            border-radius: 6px; /* ë‘¥ê¸€ê¸° ì¤„ì„ */
            font-size: 0.875rem; /* í¬ê¸° ì¤„ì„ */
            transition: all 0.2s ease;
            background: white;
        }

        .curriculum-select:focus {
            ring: 2px;
            ring-color: #3b82f6;
            border-color: #3b82f6;
            outline: none;
        }

        /* AI Agent ë·° ìµœì í™” */
        .ai-agent-container {
            height: calc(100vh - 60px); /* ìƒë‹¨ í—¤ë” ë†’ì´ ì œì™¸í•œ ì „ì²´ í™”ë©´ */
            display: flex;
            flex-direction: column;
            padding: 0.75rem; /* íŒ¨ë”© ì¤„ì„ */
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .chat-window-optimized {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem; /* íŒ¨ë”© ì¤„ì„ */
            background: #f8fafc;
            display: flex;
            flex-direction: column;
            gap: 0.5rem; /* ê°„ê²© ì¤„ì„ */
            min-height: 0; /* flexbox ìµœì í™” */
        }

        .feature-buttons-container {
            padding: 0.75rem 1rem; /* íŒ¨ë”© ì¤„ì„ */
            border-top: 1px solid #e5e7eb;
            background: white;
        }

        .chat-input-container {
            padding: 0.75rem 1rem; /* íŒ¨ë”© ì¤„ì„ */
            border-top: 1px solid #e5e7eb;
            background: white;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            .main-content {
                margin-left: 0;
                width: 100%;
                max-width: 100%;
            }
            .user-type-selector {
                position: relative;
                top: 0;
                left: 50%;
                transform: translateX(-50%); /* ëª¨ë°”ì¼ì—ì„œë„ ê°€ìš´ë° ì •ë ¬ ìœ ì§€ */
                margin-bottom: 0.75rem;
                justify-content: center; /* flex ì•„ì´í…œë“¤ë„ ê°€ìš´ë° ì •ë ¬ */
            }
            .sidebar-logo {
                margin-top: 0.5rem; /* ëª¨ë°”ì¼ì—ì„œëŠ” ê°„ê²© ì¤„ì„ */
            }
            .ai-agent-container {
                height: calc(100vh - 80px);
            }
        }

        /* ëŒ€í‘œ ì˜ˆì œ ì „ìš© ìŠ¤íƒ€ì¼ë§ - í´ë˜ìŠ¤ ê¸°ë°˜ */
        .section-ëŒ€í‘œì˜ˆì œ .accordion-content {
            padding: 1rem;
        }

        /* ë¬¸ì œ í‚¤ì›Œë“œ ìŠ¤íƒ€ì¼ë§ */
        .section-ëŒ€í‘œì˜ˆì œ .problem-keyword {
            display: inline-block;
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            margin-right: 0.5rem;
            box-shadow: 0 2px 4px rgba(249, 115, 22, 0.3);
        }

        /* ë¬¸ì œê°€ í¬í•¨ëœ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ìŠ¤íƒ€ì¼ë§ */
        .section-ëŒ€í‘œì˜ˆì œ .problem-item {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border: 2px solid #f97316;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 4px 6px -1px rgba(249, 115, 22, 0.1);
            position: relative;
        }

        .section-ëŒ€í‘œì˜ˆì œ .problem-item::before {
            content: "ğŸ“ ë¬¸ì œ";
            position: absolute;
            top: -12px;
            left: 16px;
            background: #f97316;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* í’€ì´ í‚¤ì›Œë“œ ìŠ¤íƒ€ì¼ë§ */
        .section-ëŒ€í‘œì˜ˆì œ .solution-keyword {
            display: inline-block;
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            margin-right: 0.5rem;
            box-shadow: 0 2px 4px rgba(14, 165, 233, 0.3);
        }

        /* í’€ì´ê°€ í¬í•¨ëœ ì˜ì—­ ìŠ¤íƒ€ì¼ë§ */
        .section-ëŒ€í‘œì˜ˆì œ .solution-item {
            background: linear-gradient(135deg, #f0f9ff 0%, #bae6fd 100%);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 1rem;
            margin: 0.5rem 0;
            box-shadow: 0 4px 6px -1px rgba(14, 165, 233, 0.1);
            position: relative;
        }

        .section-ëŒ€í‘œì˜ˆì œ .solution-item::before {
            content: "ğŸ’¡ í’€ì´";
            position: absolute;
            top: -12px;
            left: 16px;
            background: #0ea5e9;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* ë‹µ í‚¤ì›Œë“œ ìŠ¤íƒ€ì¼ë§ */
        .section-ëŒ€í‘œì˜ˆì œ .answer-item {
            background: linear-gradient(135deg, #f0fdf4 0%, #bbf7d0 100%);
            border: 2px solid #22c55e;
            border-radius: 12px;
            padding: 1rem;
            margin: 0.5rem 0;
            box-shadow: 0 4px 6px -1px rgba(34, 197, 94, 0.1);
            font-weight: 600;
            font-size: 1.05rem;
            position: relative;
        }

        .section-ëŒ€í‘œì˜ˆì œ .answer-item::before {
            content: "âœ“ ë‹µ";
            position: absolute;
            top: -12px;
            left: 16px;
            background: #22c55e;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* ë²ˆí˜¸ ë§¤ê¸°ê¸° ìŠ¤íƒ€ì¼ */
        .section-ëŒ€í‘œì˜ˆì œ > ol > li {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .section-ëŒ€í‘œì˜ˆì œ > ol {
            counter-reset: problem-counter;
            padding-left: 0;
        }

        .section-ëŒ€í‘œì˜ˆì œ > ol > li {
            counter-increment: problem-counter;
        }

        .section-ëŒ€í‘œì˜ˆì œ > ol > li::before {
            content: "ì˜ˆì œ " counter(problem-counter);
            position: absolute;
            top: -12px;
            left: 16px;
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* ê¸°ë³¸ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ì •ë¦¬ */
        .section-ëŒ€í‘œì˜ˆì œ ul, .section-ëŒ€í‘œì˜ˆì œ ol {
            padding-left: 1rem;
        }

        .section-ëŒ€í‘œì˜ˆì œ li {
            margin-bottom: 0.75rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="main-layout">
        <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <!-- ì‚¬ìš©ì íƒ€ì… ì„ íƒ ë²„íŠ¼ -->
            <div class="user-type-selector">
                <button class="user-type-btn active" data-type="teacher" onclick="switchUserType('teacher')">ğŸ‘©â€ğŸ« ì„ ìƒë‹˜</button>
                <button class="user-type-btn" data-type="student" onclick="switchUserType('student')">ğŸ“ í•™ìƒ</button>
                <button class="user-type-btn" data-type="parent" onclick="switchUserType('parent')">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ í•™ë¶€ëª¨</button>
            </div>
            
            <div class="sidebar-logo">
                <h1>ğŸ§­ Math Navigator</h1>
                <p class="text-sm text-slate-300 mt-1">2022 ê°œì • êµìœ¡ê³¼ì • ê¸°ë°˜(ì¤‘í•™êµ)</p>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-item active" id="menu-ai" onclick="switchToView('ai')">
                    <span>ğŸ¤–</span>
                    <span>AI ì—ì´ì „íŠ¸</span>
                </div>
                
                <div class="menu-item" id="menu-explorer" onclick="switchToView('explorer')">
                    <span>ğŸ“š</span>
                    <span>êµìœ¡ê³¼ì • íƒìƒ‰ê¸°</span>
                </div>
                
                <div class="menu-submenu" id="curriculum-submenu" style="display: none;">
                    <div class="submenu-item" onclick="scrollToSection('í•™ìŠµëª©í‘œ')">ğŸ¯ í•™ìŠµ ëª©í‘œ</div>
                    <div class="submenu-item" onclick="scrollToSection('ê°œë…ì„¤ëª…')">ğŸ“– ê°œë… ì„¤ëª…</div>
                    <div class="submenu-item" onclick="scrollToSection('ëŒ€í‘œì˜ˆì œ')">ğŸ’¡ ëŒ€í‘œ ì˜ˆì œ</div>
                    <div class="submenu-item" onclick="scrollToSection('ì—°ìŠµë¬¸ì œ')">âœï¸ ì—°ìŠµ ë¬¸ì œ</div>
                    <div class="submenu-item" onclick="scrollToSection('ì •ë‹µë°í•´ì„¤')">âœ… ì •ë‹µ ë° í•´ì„¤</div>
                    <div class="submenu-item" onclick="scrollToSection('ë§ˆìŠ¤í„°ë¦¬ë“œë¦´')">âš¡ ë§ˆìŠ¤í„°ë¦¬ ë“œë¦´</div>
                    <div class="submenu-item" onclick="scrollToSection('ì§„ë‹¨ì²´í¬')">ğŸ” ì§„ë‹¨ ì²´í¬</div>
                    <div class="submenu-item" onclick="scrollToSection('í™•ì¥í™œë™')">ğŸš€ í™•ì¥ í™œë™</div>
                    <div class="submenu-item" id="tutor-tip-menu" onclick="scrollToSection('íŠœí„°íŒ')">ğŸ’¬ íŠœí„° íŒ</div>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
        <div class="main-content">
            <!-- ìƒë‹¨ ì„±ì·¨ê¸°ì¤€ ì„ íƒ -->
            <div class="top-header">
                <label for="curriculum-select" class="curriculum-label">í˜„ì¬ í•™ìŠµ ì£¼ì œ:</label>
                <select id="curriculum-select" class="curriculum-select">
                    <option value="">-- í•™ìŠµí•  ì£¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” --</option>
                </select>
            </div>

            <!-- AI Agent ë·° -->
            <div id="ai-agent-view" class="ai-agent-container">
                <div class="chat-container">
                    <div id="chat-window" class="chat-window-optimized">
                        <div class="flex justify-start">
                            <div class="chat-bubble chat-bubble-ai p-3 rounded-lg relative"> <!-- íŒ¨ë”© ì¤„ì„ -->
                                <p class="font-semibold text-blue-600 text-sm">Math Navigator AI</p> <!-- í¬ê¸° ì¤„ì„ -->
                                <p class="mt-1 text-sm">ì•ˆë…•í•˜ì„¸ìš”! ë¨¼ì € ìƒë‹¨ ë©”ë‰´ì—ì„œ í•™ìŠµí•  ì£¼ì œ(ì„±ì·¨ê¸°ì¤€ ì½”ë“œ)ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. ê·¸ ë‹¤ìŒ, ì•„ë˜ ê¸°ëŠ¥ ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ ê¶ê¸ˆí•œ ì ì„ ì§ì ‘ ì§ˆë¬¸í•´ì£¼ì‹œë©´ ì„ íƒëœ ì£¼ì œì— ë§ì¶° ë„ì™€ë“œë¦´ê²Œìš”.</p> <!-- í¬ê¸°ì™€ ë§ˆì§„ ì¤„ì„ -->
                            </div>
                        </div>
                    </div>
                    <div id="feature-buttons" class="feature-buttons-container flex flex-wrap gap-2">
                        <!-- ë²„íŠ¼ë“¤ì€ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„± -->
                    </div>
                    <div class="chat-input-container">
                        <div class="flex items-center">
                            <input type="text" id="chat-input" class="w-full p-2.5 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition text-sm" placeholder="ì£¼ì œë¥¼ ì„ íƒí•˜ê³  ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off"> <!-- íŒ¨ë”©ê³¼ í¬ê¸° ì¤„ì„ -->
                            <button id="send-btn" class="bg-blue-600 text-white p-2.5 rounded-r-lg hover:bg-blue-700 transition flex-shrink-0"> <!-- íŒ¨ë”© ì¤„ì„ -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg> <!-- ì•„ì´ì½˜ í¬ê¸° ì¤„ì„ -->
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Curriculum Explorer ë·° -->
            <div id="curriculum-explorer-view" class="hidden p-3"> <!-- íŒ¨ë”© ë” ì¤„ì„ -->
                <main id="content-display" class="min-h-[300px]">
                    <div id="welcome-message" class="text-center text-gray-500 bg-white p-6 rounded-xl shadow-lg"> <!-- íŒ¨ë”© ì¤„ì„ -->
                        <p class="text-4xl mb-3">ğŸš€</p> <!-- í¬ê¸°ì™€ ë§ˆì§„ ë” ì¤„ì„ -->
                        <p class="text-base font-medium">ìƒë‹¨ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ì„±ì·¨ê¸°ì¤€ ì½”ë“œë¥¼ ì„ íƒí•˜ë©´<br>ê´€ë ¨ í•™ìŠµ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p> <!-- í¬ê¸° ì¤„ì„ -->
                    </div>
                    <div id="content-area" class="content-area"></div>
                </main>
            </div>

            <!-- Footer -->
            <footer class="text-center py-3 text-gray-400 text-xs"> <!-- íŒ¨ë”©ê³¼ í¬ê¸° ë” ì¤„ì„ -->
                <p>&copy; 2024 Math Navigator AI Project. All rights reserved.</p>
            </footer>
        </div>
    </div>

    <script>
        // DOM Elements
        const selectElement = document.getElementById('curriculum-select');
        const contentDisplay = document.getElementById('content-display');
        const welcomeMessage = document.getElementById('welcome-message');
        const contentArea = document.getElementById('content-area');
        const chatWindow = document.getElementById('chat-window');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const aiAgentView = document.getElementById('ai-agent-view');
        const curriculumExplorerView = document.getElementById('curriculum-explorer-view');
        const curriculumSubmenu = document.getElementById('curriculum-submenu');
        const featureButtons = document.getElementById('feature-buttons');
        const tutorTipMenu = document.getElementById('tutor-tip-menu');

        let curriculumData = {}; // Store the loaded JSON data
        let currentView = 'ai';
        let currentUserType = 'teacher'; // ê¸°ë³¸ê°’: ì„ ìƒë‹˜

        // ì‚¬ìš©ì íƒ€ì…ë³„ ê¸°ëŠ¥ ë²„íŠ¼ ì •ì˜
        const userTypeFeatures = {
            teacher: [
                { id: 'quiz', text: 'ğŸ“ í€´ì¦ˆ ë§Œë“¤ê¸°', color: 'blue' },
                { id: 'lesson_plan', text: 'ğŸ“‹ ìˆ˜ì—…ê³„íšì•ˆ ì§œê¸°', color: 'green' },
                { id: 'assessment', text: 'âœ… ìˆ˜í–‰í‰ê°€ ë§Œë“¤ê¸°', color: 'purple' }
            ],
            student: [
                { id: 'quiz_solve', text: 'ğŸ¯ í€´ì¦ˆ í’€ì–´ë³´ê¸°', color: 'blue' },
                { id: 'flashcard', text: 'ğŸƒ í•µì‹¬ ì•”ê¸° ì¹´ë“œ', color: 'green' },
                { id: 'study_tips', text: 'ğŸ’¡ ì‹¤ì „ ëŒ€ë¹„ íŒ', color: 'purple' }
            ],
            parent: [
                { id: 'quiz_solve', text: 'ğŸ¯ í€´ì¦ˆ í’€ì–´ë³´ê¸°', color: 'blue' },
                { id: 'flashcard', text: 'ğŸƒ í•µì‹¬ ì•”ê¸° ì¹´ë“œ', color: 'green' },
                { id: 'parent_tips', text: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ìš°ë¦¬ ì•„ì´ í•™ìŠµ íŒ', color: 'purple' }
            ]
        };

        // ì‚¬ìš©ì íƒ€ì… ì „í™˜ í•¨ìˆ˜
        function switchUserType(userType) {
            currentUserType = userType;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.user-type-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-type="${userType}"]`).classList.add('active');
            
            // ê¸°ëŠ¥ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            updateFeatureButtons();
            
            // íŠœí„° íŒ ë©”ë‰´ ì—…ë°ì´íŠ¸
            updateTutorTipMenu();
            
            // í˜„ì¬ í‘œì‹œëœ ì½˜í…ì¸  ìƒˆë¡œê³ ì¹¨ (íƒìƒ‰ê¸° ë·°ì¸ ê²½ìš°)
            if (currentView === 'explorer' && selectElement.value) {
                displayContent(selectElement.value);
            }
        }

        // ê¸°ëŠ¥ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateFeatureButtons() {
            const features = userTypeFeatures[currentUserType];
            featureButtons.innerHTML = '';
            
            features.forEach(feature => {
                const button = document.createElement('button');
                button.onclick = () => handleFeatureClick(feature.id);
                button.className = `bg-${feature.color}-100 text-${feature.color}-800 font-medium px-3 py-1.5 rounded-full hover:bg-${feature.color}-200 transition transform hover:scale-105 text-xs`; // í¬ê¸° ë” ì¤„ì„
                button.textContent = feature.text;
                featureButtons.appendChild(button);
            });
        }

        // íŠœí„° íŒ ë©”ë‰´ ì—…ë°ì´íŠ¸
        function updateTutorTipMenu() {
            if (currentUserType === 'student') {
                // í•™ìƒ ëª¨ë“œ: íŠœí„° íŒ ë©”ë‰´ ì™„ì „íˆ ìˆ¨ê¹€
                tutorTipMenu.style.display = 'none';
            } else if (currentUserType === 'parent') {
                // í•™ë¶€ëª¨ ëª¨ë“œ: í•™ë¶€ëª¨ íŒìœ¼ë¡œ ë³€ê²½
                tutorTipMenu.style.display = 'block';
                tutorTipMenu.innerHTML = 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ í•™ë¶€ëª¨ íŒ';
                tutorTipMenu.onclick = () => scrollToSection('í•™ë¶€ëª¨íŒ');
            } else {
                // ì„ ìƒë‹˜ ëª¨ë“œ: íŠœí„° íŒ í‘œì‹œ
                tutorTipMenu.style.display = 'block';
                tutorTipMenu.innerHTML = 'ğŸ’¬ íŠœí„° íŒ';
                tutorTipMenu.onclick = () => scrollToSection('íŠœí„°íŒ');
            }
        }

        // 1. Fetch and Load JSON Data from our Backend
        async function loadData() {
            try {
                const response = await fetch('/api/curriculum-data');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                curriculumData = await response.json();
                populateSelectOptions();
                updateFeatureButtons(); // ì´ˆê¸° ë²„íŠ¼ ìƒì„±
            } catch (error) {
                console.error("ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:", error);
                alert("êµìœ¡ê³¼ì • ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }
        }

        function populateSelectOptions() {
            const codes = Object.keys(curriculumData);
            codes.forEach(code => {
                const option = document.createElement('option');
                option.value = code;
                const title = curriculumData[code]["í•™ìŠµ ëª©í‘œ"] || "ì œëª© ì—†ìŒ";
                // í…ìŠ¤íŠ¸ ê¸¸ì´ ì œí•œì„ ëŠ˜ë¦¼
                const truncatedTitle = title.length > 80 ? title.substring(0, 80) + "..." : title;
                option.textContent = `${code} - ${truncatedTitle}`;
                selectElement.appendChild(option);
            });
        }

        // ë·° ì „í™˜ í•¨ìˆ˜
        function switchToView(view) {
            currentView = view;
            
            // ë©”ë‰´ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            
            if (view === 'ai') {
                aiAgentView.classList.remove('hidden');
                curriculumExplorerView.classList.add('hidden');
                curriculumSubmenu.style.display = 'none';
                document.getElementById('menu-ai').classList.add('active');
            } else if (view === 'explorer') {
                curriculumExplorerView.classList.remove('hidden');
                aiAgentView.classList.add('hidden');
                curriculumSubmenu.style.display = 'block';
                document.getElementById('menu-explorer').classList.add('active');
                displayContent(selectElement.value);
            }
        }

        // êµìœ¡ê³¼ì • ì„ íƒ í•¨ìˆ˜
        function selectCurriculum(code) {
            selectElement.value = code;
            if (currentView === 'explorer') {
                displayContent(code);
            }
            
            // ì„œë¸Œë©”ë‰´ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.submenu-item').forEach(item => item.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }

        // ì„¹ì…˜ë³„ ë°”ë¡œê°€ê¸° í•¨ìˆ˜
        function scrollToSection(sectionName) {
            if (currentView !== 'explorer') {
                switchToView('explorer');
            }
            
            // ì„±ì·¨ê¸°ì¤€ì´ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° ì•ˆë‚´
            if (!selectElement.value) {
                alert('ë¨¼ì € ìƒë‹¨ì—ì„œ ì„±ì·¨ê¸°ì¤€ ì½”ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            setTimeout(() => {
                const sectionId = `section-${sectionName}`;
                const sectionElement = document.getElementById(sectionId);
                
                if (sectionElement) {
                    // í•´ë‹¹ ì„¹ì…˜ì´ ë‹«í˜€ìˆë‹¤ë©´ ì—´ê¸°
                    if (!sectionElement.classList.contains('active')) {
                        toggleAccordion(sectionId);
                    }
                    
                    // ì •í™•í•œ ìœ„ì¹˜ ê³„ì‚° (í—¤ë”ë¥¼ ê³ ë ¤)
                    const accordionItem = sectionElement.closest('.accordion-item');
                    const accordionHeader = accordionItem.querySelector('.accordion-header');
                    const headerOffset = 100; // ìƒë‹¨ ê³ ì • í—¤ë” ë†’ì´ + ì—¬ë°± (ì¤„ì„)
                    
                    // ì •í™•í•œ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ê³„ì‚°
                    const elementPosition = accordionHeader.offsetTop;
                    const offsetPosition = elementPosition - headerOffset;
                    
                    // ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤
                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                    
                    // ì„œë¸Œë©”ë‰´ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
                    document.querySelectorAll('.submenu-item').forEach(item => item.classList.remove('active'));
                    if (event && event.target) {
                        event.target.classList.add('active');
                    }
                    
                    // ì ê¹ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼
                    accordionItem.style.background = 'linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)';
                    accordionItem.style.transform = 'scale(1.02)';
                    accordionItem.style.transition = 'all 0.3s ease';
                    
                    setTimeout(() => {
                        accordionItem.style.background = '';
                        accordionItem.style.transform = '';
                        accordionItem.style.transition = '';
                    }, 1000);
                }
            }, 200);
        }

        // ì„¹ì…˜ë³„ ì•„ì´ì½˜ ë§¤í•‘
        const sectionIcons = {
            "í•™ìŠµ ëª©í‘œ": "ğŸ¯",
            "ê°œë… ì„¤ëª…": "ğŸ“–", 
            "ëŒ€í‘œ ì˜ˆì œ": "ğŸ’¡",
            "ì—°ìŠµ ë¬¸ì œ": "âœï¸",
            "ì •ë‹µ ë° í•´ì„¤": "âœ…",
            "ë§ˆìŠ¤í„°ë¦¬ ë“œë¦´": "âš¡",
            "ì§„ë‹¨ ì²´í¬": "ğŸ”",
            "í™•ì¥ í™œë™": "ğŸš€",
            "íŠœí„° íŒ": "ğŸ’¬",
            "í•™ë¶€ëª¨ íŒ": "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"
        };

        function displayContent(code) {
            if (!code) {
                welcomeMessage.classList.remove('hidden');
                contentArea.innerHTML = '';
                return;
            }
            welcomeMessage.classList.add('hidden');
            contentArea.innerHTML = ''; 
            const data = curriculumData[code];
            if (!data) {
                contentArea.innerHTML = '<p class="bg-white p-6 rounded-lg shadow-md text-center text-gray-500">í•´ë‹¹ ì½”ë“œì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            // ì‚¬ìš©ì íƒ€ì…ì— ë”°ë¥¸ ì„¹ì…˜ ìˆœì„œ ì •ì˜
            let sectionOrder;
            if (currentUserType === 'student') {
                sectionOrder = ["í•™ìŠµ ëª©í‘œ", "ê°œë… ì„¤ëª…", "ëŒ€í‘œ ì˜ˆì œ", "ì—°ìŠµ ë¬¸ì œ", "ì •ë‹µ ë° í•´ì„¤", "ë§ˆìŠ¤í„°ë¦¬ ë“œë¦´", "ì§„ë‹¨ ì²´í¬", "í™•ì¥ í™œë™"];
            } else if (currentUserType === 'parent') {
                sectionOrder = ["í•™ìŠµ ëª©í‘œ", "ê°œë… ì„¤ëª…", "ëŒ€í‘œ ì˜ˆì œ", "ì—°ìŠµ ë¬¸ì œ", "ì •ë‹µ ë° í•´ì„¤", "ë§ˆìŠ¤í„°ë¦¬ ë“œë¦´", "ì§„ë‹¨ ì²´í¬", "í™•ì¥ í™œë™", "í•™ë¶€ëª¨ íŒ"];
            } else { // teacher
                sectionOrder = ["í•™ìŠµ ëª©í‘œ", "ê°œë… ì„¤ëª…", "ëŒ€í‘œ ì˜ˆì œ", "ì—°ìŠµ ë¬¸ì œ", "ì •ë‹µ ë° í•´ì„¤", "ë§ˆìŠ¤í„°ë¦¬ ë“œë¦´", "ì§„ë‹¨ ì²´í¬", "í™•ì¥ í™œë™", "íŠœí„° íŒ"];
            }
            
            const defaultOpenSections = ["í•™ìŠµ ëª©í‘œ", "ê°œë… ì„¤ëª…"];
            
            let htmlContent = '';
            sectionOrder.forEach(sectionName => {
                let dataKey = sectionName;
                // í•™ë¶€ëª¨ íŒì˜ ê²½ìš° íŠœí„° íŒ ë°ì´í„°ë¥¼ ì‚¬ìš©
                if (sectionName === "í•™ë¶€ëª¨ íŒ") {
                    dataKey = "íŠœí„° íŒ";
                }
                
                if (data[dataKey]) {
                    const markdownText = data[dataKey];
                    const sectionHtml = marked.parse(markdownText);
                    const sectionId = `section-${sectionName.replace(/\s+/g, '')}`;
                    const icon = sectionIcons[sectionName] || "ğŸ“„";
                    const isOpen = defaultOpenSections.includes(sectionName);
                    const sectionClass = `section-${sectionName.replace(/\s+/g, '')}`;
                    
                    htmlContent += `
                        <div class="accordion-item ${sectionClass}">
                            <div class="accordion-header" onclick="toggleAccordion('${sectionId}')">
                                <div class="flex items-center space-x-3">
                                    <span class="text-xl">${icon}</span> <!-- ì•„ì´ì½˜ í¬ê¸° ì¤„ì„ -->
                                    <span class="text-base">${sectionName}</span> <!-- í…ìŠ¤íŠ¸ í¬ê¸° ì¤„ì„ -->
                                </div>
                                <span class="accordion-icon ${isOpen ? 'rotated' : ''}">â–¼</span>
                            </div>
                            <div id="${sectionId}" class="accordion-content ${isOpen ? 'active' : ''}">
                                ${sectionHtml}
                            </div>
                        </div>
                    `;
                }
            });
            
            contentArea.innerHTML = htmlContent;
            renderMath(contentArea);
            
            // ëŒ€í‘œ ì˜ˆì œ ì„¹ì…˜ ìŠ¤íƒ€ì¼ë§ ì ìš© (ë” ì•ˆì „í•˜ê²Œ)
            setTimeout(() => {
                const exampleSection = contentArea.querySelector('#section-ëŒ€í‘œì˜ˆì œ');
                if (exampleSection && !exampleSection.dataset.exampleStyled) {
                    styleExampleSection(exampleSection);
                }
            }, 100);
        }

        // ì•„ì½”ë””ì–¸ í† ê¸€ í•¨ìˆ˜
        function toggleAccordion(sectionId) {
            const content = document.getElementById(sectionId);
            const header = content.previousElementSibling;
            const icon = header.querySelector('.accordion-icon');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.classList.remove('rotated');
            } else {
                content.classList.add('active');
                icon.classList.add('rotated');
                renderMath(content);
                
                // ëŒ€í‘œ ì˜ˆì œ ì„¹ì…˜ì¸ ê²½ìš° ìŠ¤íƒ€ì¼ë§ ì ìš©
                if (sectionId === 'section-ëŒ€í‘œì˜ˆì œ') {
                    styleExampleSection(content);
                }
            }
        }

        // KaTeX ìˆ˜ì‹ ë Œë”ë§ - ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•
        function renderMath(element) {
            if (!element) return;
            
            // ì´ë¯¸ ì²˜ë¦¬ëœ ìš”ì†ŒëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ
            if (element.dataset.mathDone === 'true') {
                return;
            }
            
            console.log('ìˆ˜ì‹ ë Œë”ë§ ì‹œì‘:', element);
            
            // KaTeX ë¡œë”© í™•ì¸
            if (!window.katex) {
                console.error('KaTeXê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                return;
            }
            
            try {
                let html = element.innerHTML;
                let originalHtml = html;
                
                // ë¸”ë¡ ìˆ˜ì‹ ì²˜ë¦¬ ($$...$$)
                html = html.replace(/\$\$([^$]+?)\$\$/g, function(match, tex) {
                    console.log('ë¸”ë¡ ìˆ˜ì‹ ë°œê²¬:', tex);
                    try {
                        const rendered = katex.renderToString(tex.trim(), { 
                            displayMode: true, 
                            throwOnError: false 
                        });
                        console.log('ë¸”ë¡ ìˆ˜ì‹ ë Œë”ë§ ì„±ê³µ');
                        return rendered;
                    } catch (e) {
                        console.error('ë¸”ë¡ ìˆ˜ì‹ ë Œë”ë§ ì‹¤íŒ¨:', e);
                        return match;
                    }
                });
                
                // ì¸ë¼ì¸ ìˆ˜ì‹ ì²˜ë¦¬ ($...$)
                html = html.replace(/\$([^$\n]+?)\$/g, function(match, tex) {
                    console.log('ì¸ë¼ì¸ ìˆ˜ì‹ ë°œê²¬:', tex);
                    try {
                        const rendered = katex.renderToString(tex.trim(), { 
                            displayMode: false, 
                            throwOnError: false 
                        });
                        console.log('ì¸ë¼ì¸ ìˆ˜ì‹ ë Œë”ë§ ì„±ê³µ');
                        return rendered;
                    } catch (e) {
                        console.error('ì¸ë¼ì¸ ìˆ˜ì‹ ë Œë”ë§ ì‹¤íŒ¨:', e);
                        return match;
                    }
                });
                
                // ë³€ê²½ì‚¬í•­ì´ ìˆìœ¼ë©´ ì ìš©
                if (html !== originalHtml) {
                    element.innerHTML = html;
                    console.log('ìˆ˜ì‹ ë Œë”ë§ ì™„ë£Œ!');
                } else {
                    console.log('ë Œë”ë§í•  ìˆ˜ì‹ì´ ì—†ìŒ');
                }
                
                // ì²˜ë¦¬ ì™„ë£Œ ë§ˆí‚¹
                element.dataset.mathDone = 'true';
                
            } catch (error) {
                console.error('ì „ì²´ ìˆ˜ì‹ ë Œë”ë§ ì˜¤ë¥˜:', error);
                element.dataset.mathDone = 'true';
            }
        }

        // ëŒ€í‘œ ì˜ˆì œ ìŠ¤íƒ€ì¼ë§ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetExampleStyling() {
            const exampleSections = document.querySelectorAll('[data-example-styled="true"]');
            exampleSections.forEach(section => {
                section.dataset.exampleStyled = 'false';
                // ì›ë³¸ ì½˜í…ì¸ ë¡œ ë³µì›í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨ì´ í•„ìš”í•  ìˆ˜ ìˆìŒ
            });
            console.log('ëŒ€í‘œ ì˜ˆì œ ìŠ¤íƒ€ì¼ë§ ì´ˆê¸°í™”ë¨');
        }

        // ëŒ€í‘œ ì˜ˆì œ ìŠ¤íƒ€ì¼ë§ í•¨ìˆ˜ - ì •í™•í•œ íƒ€ê²ŸíŒ…
        function styleExampleSection(element) {
            if (!element || element.dataset.exampleStyled === 'true') {
                return;
            }
            
            try {
                // ëª¨ë“  li ìš”ì†Œ ì°¾ê¸°
                const allLis = element.querySelectorAll('li');
                
                allLis.forEach(li => {
                    const text = li.textContent.trim();
                    const strongTags = li.querySelectorAll('strong');
                    
                    // ì´ë¯¸ ìŠ¤íƒ€ì¼ì´ ì ìš©ëœ ìš”ì†ŒëŠ” ê±´ë„ˆë›°ê¸°
                    if (li.classList.contains('problem-item') || 
                        li.classList.contains('solution-item') || 
                        li.classList.contains('answer-item')) {
                        return;
                    }
                    
                    // ì²« ë²ˆì§¸ strong íƒœê·¸ì˜ ë‚´ìš©ìœ¼ë¡œë§Œ íŒë‹¨
                    if (strongTags.length > 0) {
                        const firstStrongText = strongTags[0].textContent.trim();
                        
                        // ë¬¸ì œë¡œ ì‹œì‘í•˜ëŠ” lië§Œ ë¬¸ì œ ë°•ìŠ¤ë¡œ
                        if (firstStrongText === 'ë¬¸ì œ') {
                            strongTags[0].classList.add('problem-keyword');
                            li.classList.add('problem-item');
                        }
                        // í’€ì´ë¡œ ì‹œì‘í•˜ëŠ” lië§Œ í’€ì´ ë°•ìŠ¤ë¡œ
                        else if (firstStrongText === 'í’€ì´' || firstStrongText.startsWith('í’€ì´ ')) {
                            strongTags[0].classList.add('solution-keyword');
                            li.classList.add('solution-item');
                        }
                    }
                    
                    // "ë‹µ:" ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë…ë¦½ì ì¸ lië§Œ ë‹µ ë°•ìŠ¤ë¡œ
                    if (text.startsWith('ë‹µ:') && text.length < 100) {
                        li.classList.add('answer-item');
                    }
                });
                
                element.dataset.exampleStyled = 'true';
                console.log('ëŒ€í‘œ ì˜ˆì œ ì •í™•í•œ ìŠ¤íƒ€ì¼ë§ ì™„ë£Œ');
                
            } catch (error) {
                console.error('ëŒ€í‘œ ì˜ˆì œ ìŠ¤íƒ€ì¼ë§ ì˜¤ë¥˜:', error);
                element.dataset.exampleStyled = 'true';
            }
        }

        // ì±„íŒ… ê´€ë ¨ í•¨ìˆ˜ë“¤
        function addChatMessage(message, sender, rawMessage = null) {
            const messageWrapper = document.createElement('div');
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'chat-bubble p-3 rounded-lg relative'; // íŒ¨ë”© ë” ì¤„ì„

            if (sender === 'user') {
                messageWrapper.className = 'flex justify-end';
                bubbleDiv.classList.add('chat-bubble-user');
                bubbleDiv.textContent = message;
            } else { // AI
                messageWrapper.className = 'flex items-start justify-start';
                bubbleDiv.classList.add('chat-bubble-ai');
                bubbleDiv.innerHTML = `<p class="font-semibold mb-1.5 text-blue-600 text-sm">Math Navigator AI</p><div class="ai-response text-sm">${message}</div>`; // ë§ˆì§„ê³¼ í¬ê¸° ì¤„ì„

                if(rawMessage) {
                    bubbleDiv.querySelector('.ai-response').dataset.rawText = rawMessage;
                }

                const copyButton = document.createElement('button');
                copyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`; // ì•„ì´ì½˜ í¬ê¸° ì¤„ì„
                copyButton.className = "absolute top-1.5 right-1.5 p-1.5 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition text-xs"; // ìœ„ì¹˜ì™€ í¬ê¸° ì¡°ì •
                copyButton.title = "ë‹µë³€ ë³µì‚¬";
                copyButton.onclick = copyToClipboard;
                
                // êµ¬ê¸€ ë…ìŠ¤ ë‚´ë³´ë‚´ê¸° ë²„íŠ¼
                const exportButton = document.createElement('button');
                exportButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10,9 9,9 8,9"></polyline></svg>`; // ì•„ì´ì½˜ í¬ê¸° ì¤„ì„
                exportButton.className = "absolute top-1.5 right-10 p-1.5 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition text-xs"; // ìœ„ì¹˜ì™€ í¬ê¸° ì¡°ì •
                exportButton.title = "êµ¬ê¸€ ë…ìŠ¤ë¡œ ë‚´ë³´ë‚´ê¸°";
                exportButton.onclick = exportToGoogleDocs;
                
                bubbleDiv.appendChild(copyButton);
                bubbleDiv.appendChild(exportButton);
            }

            messageWrapper.appendChild(bubbleDiv);
            chatWindow.appendChild(messageWrapper);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return bubbleDiv.querySelector('.ai-response');
        }

        function copyToClipboard(event) {
            const button = event.currentTarget;
            const aiResponseDiv = button.closest('.chat-bubble-ai').querySelector('.ai-response');
            const textToCopy = aiResponseDiv.dataset.rawText;

            if (textToCopy) {
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    button.innerHTML = 'âœ…';
                    setTimeout(() => {
                         button.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
                    }, 2000);
                } catch (err) {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                    alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                document.body.removeChild(textArea);
            }
        }

        // êµ¬ê¸€ ë…ìŠ¤ë¡œ ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜
        function exportToGoogleDocs(event) {
            const button = event.currentTarget;
            const aiResponseDiv = button.closest('.chat-bubble-ai').querySelector('.ai-response');
            const textToExport = aiResponseDiv.dataset.rawText;

            if (textToExport) {
                try {
                    // ë§ˆí¬ë‹¤ìš´ì„ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
                    let cleanText = textToExport
                        .replace(/\*\*(.*?)\*\*/g, '$1')
                        .replace(/\*(.*?)\*/g, '$1')
                        .replace(/`(.*?)`/g, '$1')
                        .replace(/#{1,6}\s?/g, '')
                        .replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1')
                        .replace(/\$\$(.*?)\$\$/g, '$1')
                        .replace(/\$(.*?)\$/g, '$1')
                        .replace(/>\s*/g, '')
                        .replace(/^\s*[-*+]\s+/gm, 'â€¢ ')
                        .replace(/^\s*\d+\.\s+/gm, '')
                        .trim();

                    // í˜„ì¬ ë‚ ì§œ ì¶”ê°€
                    const now = new Date();
                    const dateStr = now.toLocaleDateString('ko-KR');
                    const documentTitle = 'Math Navigator AI ë‹µë³€ - ' + dateStr;
                    const documentContent = documentTitle + '\nìƒì„±ì¼ì‹œ: ' + dateStr + '\n\n' + cleanText;

                    // í´ë¦½ë³´ë“œì— ë³µì‚¬
                    const textArea = document.createElement("textarea");
                    textArea.value = documentContent;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    // êµ¬ê¸€ ë…ìŠ¤ ì—´ê¸°
                    window.open('https://docs.google.com/document/', '_blank');
                    
                    // ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´
                    alert('ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nìƒˆë¡œ ì—´ë¦° êµ¬ê¸€ ë…ìŠ¤ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V)í•˜ì„¸ìš”.');

                    // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                    button.innerHTML = 'ğŸ“„';
                    button.style.background = '#34a853';
                    button.style.color = 'white';
                    
                    setTimeout(function() {
                        button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10,9 9,9 8,9"></polyline></svg>';
                        button.style.background = '#dbeafe';
                        button.style.color = '#2563eb';
                    }, 3000);

                } catch (err) {
                    console.error('êµ¬ê¸€ ë…ìŠ¤ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', err);
                    alert('êµ¬ê¸€ ë…ìŠ¤ ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        function handleFeatureClick(feature) {
            const selectedCode = selectElement.value;
            if (!selectedCode) {
                alert('ë¨¼ì € ìƒë‹¨ ë©”ë‰´ì—ì„œ í•™ìŠµí•  ì£¼ì œ(ì„±ì·¨ê¸°ì¤€ ì½”ë“œ)ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            let prompt = '';
            switch(feature) {
                // ì„ ìƒë‹˜ìš©
                case 'quiz':
                    prompt = `í˜„ì¬ ì„ íƒëœ ì„±ì·¨ê¸°ì¤€ ì½”ë“œ [${selectedCode}]ì— ëŒ€í•œ ê°ê´€ì‹ ì—°ìŠµë¬¸ì œ 3ê°œë¥¼ ì •ë‹µ ë° í•´ì„¤ê³¼ í•¨ê»˜ ë§Œë“¤ì–´ì¤˜.`;
                    break;
                case 'lesson_plan':
                    prompt = `í˜„ì¬ ì„ íƒëœ ì„±ì·¨ê¸°ì¤€ ì½”ë“œ [${selectedCode}]ë¥¼ ì£¼ì œë¡œ, 'ë„ì…-ì „ê°œ-ì •ë¦¬' í˜•ì‹ì˜ í•œ ì°¨ì‹œ ìˆ˜ì—…ê³„íšì•ˆì„ êµ¬ì²´ì ìœ¼ë¡œ ì§œì¤˜.`;
                    break;
                case 'assessment':
                    prompt = `í˜„ì¬ ì„ íƒëœ ì„±ì·¨ê¸°ì¤€ ì½”ë“œ [${selectedCode}]ì™€ ê´€ë ¨ëœ ê³¼ì •ì¤‘ì‹¬ ìˆ˜í–‰í‰ê°€ ì•„ì´ë””ì–´ë¥¼ ì±„ì  ê¸°ì¤€í‘œ(ë£¨ë¸Œë¦­)ë¥¼ í¬í•¨í•˜ì—¬ ì œì•ˆí•´ì¤˜.`;
                    break;
                // í•™ìƒìš©
                case 'quiz_solve':
                    prompt = `í˜„ì¬ ì„ íƒëœ ì„±ì·¨ê¸°ì¤€ ì½”ë“œ [${selectedCode}]ì— ëŒ€í•œ ê°ê´€ì‹ ì—°ìŠµë¬¸ì œ 3ê°œë¥¼ ë§Œë“¤ì–´ì£¼ê³ , ê° ë¬¸ì œì— ëŒ€í•œ í•´ì„¤ë„ í•¨ê»˜ ì œê³µí•´ì¤˜. í•™ìƒì´ ê³µë¶€í•˜ê¸° ì¢‹ë„ë¡ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•´ì¤˜.`;
                    break;
                case 'flashcard':
                    prompt = `í˜„ì¬ ì„ íƒëœ ì„±ì·¨ê¸°ì¤€ ì½”ë“œ [${selectedCode}]ì˜ í•µì‹¬ ê°œë…ë“¤ì„ ì•”ê¸°ì¹´ë“œ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•´ì¤˜. ì•ë©´ì—ëŠ” ì§ˆë¬¸ì´ë‚˜ ê°œë…, ë’·ë©´ì—ëŠ” ë‹µì´ë‚˜ ì„¤ëª…ì´ ì˜¤ë„ë¡ ë§Œë“¤ì–´ì¤˜.`;
                    break;
                case 'study_tips':
                    prompt = `í˜„ì¬ ì„ íƒëœ ì„±ì·¨ê¸°ì¤€ ì½”ë“œ [${selectedCode}]ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ê³µë¶€í•˜ê³  ì‹œí—˜ì—ì„œ ì¢‹ì€ ì ìˆ˜ë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ” ì‹¤ì „ ëŒ€ë¹„ íŒê³¼ í•™ìŠµ ì „ëµì„ ì•Œë ¤ì¤˜.`;
                    break;
                // í•™ë¶€ëª¨ìš©
                case 'parent_tips':
                    prompt = `í˜„ì¬ ì„ íƒëœ ì„±ì·¨ê¸°ì¤€ ì½”ë“œ [${selectedCode}]ë¥¼ ê³µë¶€í•˜ëŠ” ìš°ë¦¬ ì•„ì´ë¥¼ ì–´ë–»ê²Œ ë„ì™€ì¤„ ìˆ˜ ìˆëŠ”ì§€, í•™ë¶€ëª¨ë¡œì„œ í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ í•™ìŠµ ì§€ì› ë°©ë²•ê³¼ íŒì„ ì•Œë ¤ì¤˜.`;
                    break;
            }
            addChatMessage(prompt, 'user');
            callAIAgent(prompt);
        }

        async function handleSendMessage() {
            const userInput = chatInput.value.trim();
            if (!userInput) return;
            addChatMessage(userInput, 'user');
            chatInput.value = '';
            await callAIAgent(userInput);
        }

        // AI Agent API Call (to our own backend)
        async function callAIAgent(userInput) {
            const aiResponseContainer = addChatMessage('<span class="blinking-cursor"></span>', 'ai', '');
            const selectedCode = selectElement.value;

            try {
                const response = await fetch('/api/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: userInput,
                        code: selectedCode
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }

                const result = await response.json();
                const aiText = result.answer;

                aiResponseContainer.dataset.rawText = aiText;
                aiResponseContainer.innerHTML = marked.parse(aiText);
                renderMath(aiResponseContainer);

            } catch (error) {
                console.error("AI ì—ì´ì „íŠ¸ í˜¸ì¶œ ì˜¤ë¥˜:", error);
                aiResponseContainer.innerHTML = `<p class="text-red-500">AIì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>${error.message}</p>`;
            }
        }

        // Event Listeners
        sendBtn.addEventListener('click', handleSendMessage);
        chatInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') { handleSendMessage(); }
        });
        selectElement.addEventListener('change', (event) => {
            if (currentView === 'explorer') {
                displayContent(event.target.value);
            }
        });

        // Initial Load
        window.onload = function() {
            // KaTeX ë¡œë”© ìƒíƒœ í™•ì¸
            console.log('KaTeX ìƒíƒœ í™•ì¸:');
            console.log('window.katex:', !!window.katex);
            console.log('window.renderMathInElement:', !!window.renderMathInElement);
            
            // ë°ì´í„° ë¡œë“œ
            loadData();
        };
    </script>

</body>
</html>
